# API для работы с базой данных
*Этот файл поддерживается в формате [Markdown]*

## Соглашения
1. Протокол передачи данных [HTTP]

2. Формат приема-передачи данных [JSON] созданный в кодировке [UTF-8] без [BOM].

3. Общий url-формат:
  ```
  POST http://{addr}/{user}/{action}
  ```

4. Коды состояния [стандартные](http://en.wikipedia.org/wiki/List_of_HTTP_status_codes) и возвращаются всегда. Клиент имеет право на их интерпретацию. Ошибки могут быть дополнительно подробно описаны в теле ответа запроса.

## Методы UserDB API

### `/user_get`
Получения информации о пользователе.
```
POST http://{addr}/users/user_get
```

Сообщение отправляется в следующем формате:
```
{
    "id_user": "string" // Идентификатор пользователя
}
```

Пример команды отправки файла с данными *data.json* при помощи служебной программы [cURL]:
```sh
curl -X POST -T "data.json" http://{addr}/users/user_get
```

В случае успеха, будет получен json ответ, в следующем формате:
```
{
    "id_user":    "string", // Идентификатор пользователя
    "user_phone": "string"  // Телефон
}
```

Возможны следующие коды состояния:
* `200` - пользователь найден
* `404` - пользователя с таким ID нет в базе

## Методы TransactionDB API

### `/get`
Получение информации о проведенных транзакциях
```
POST http://{addr}/trans/get
```

Запрос выполняется в следующем формате:
```
{
    "req_type": "string", // Зона поиска
    "id":       "string"  // Идентификатор для поиска
}
```

Зона поиска указывается в JSON запросе и имеет следующие состояния:
* `userid` - поиск по идентификатору пользователя
* `shopid` - поиск по идентификатору торговой точки
* `dragid` - поиск по идентификатору лекарственного препарата

Пример команды отправки файла с данными *data.json* при помощи служебной программы [cURL]:
```sh
curl -X POST -T "data.json" http://{addr}/trans/get
```

В случае успеха, будет получен json ответ, в следующем формате:
```
{
    "meta": {
        "id":      "string", // Идентификатор запроса
        "id_shop": "string", // Идентификатор торговой точки
        "id_lang": "string", // Идентификатор языка ("ru", "ua")
        "id_user": "string", // Идентификатор пользователя

        "user_phone":  "string", // Телефон

        "apt_status_code": "string", // Статус обработки запроса ("ACCEPT", "REPEAT")
        "apt_status_text": "string", // Сообщение клиенту от аптеки
        "apt_num_order":   "string"  // Номер брони в аптеке (в случае успешного бронирования)
    },
    "data": [{
        "id": "string", // Идентификатор товара
        "quant": 0.0,   // Количество (float)
        "price": 0.0    // Цена (float)
    }]
}
```

Возможны следующие коды состояния:
* `200` - информация найдена
* `404` - по данному запросу в базе ничего не найдено

[Markdown]:https://ru.wikipedia.org/wiki/Markdown
[JSON]:http://json.org/json-ru.html
[UTF-8]:https://ru.wikipedia.org/w/index.php?title=UTF-8
[BOM]:https://ru.wikipedia.org/w/index.php?oldid=70741439
[HTTP]:https://ru.wikipedia.org/wiki/HTTP
[cURL]:https://ru.wikipedia.org/wiki/CURL
