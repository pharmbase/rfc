# API работы с данными в UserDB
*Этот файл поддерживается в формате [Markdown]*

## Соглашения
1. Протокол передачи данных [HTTP]

2. Формат приема-передачи данных [JSON] созданный в кодировке [UTF-8] без [BOM].

3. Коды состояния [стандартные](http://en.wikipedia.org/wiki/List_of_HTTP_status_codes) и возвращаются всегда. Клиент имеет право на их интерпретацию. Ошибки могут быть дополнительно подробно описаны в теле ответа запроса.

## Методы

### `/get_id_by_phone`
Запрос на проверку наличия идентификатора пользователя по номеру телефона.
```
POST http://{addr}/get_id_by_phone
```

Пример команды при помощи служебной программы [cURL]:
```sh
curl -v -X POST -H "Content-Type: application/json" -d '{"phone":"380632224455"}' http://{addr}/get_id_by_phone
```

Сообщение отправляется в следующем формате:
```
{
  "phone": "string" // Телефон пользователя в международном формате
}
```

Пример первого сообщения:
```
{
  "phone": "380631234567"
}
```

Ответ будет получен в следующем формате:
```
{
  "id": "string" // Идентификатор пользователя
}
```

Пример ответа от сервиса:
```
{
  "id": "654886"
}
```

Возможны следующие коды состояния при отправке данных на сервис:
* `200` - данные успешно обработаны, отправлен ответ
* `404` - пользователь является непроверенным, либо не существует

В случае ошибки 404, в теле ответа будет передана структура следующего формата:
```
{
  "code": "string", // Код ошибки
  "text": "string"  // Описание ошибки
}
```

### `/check_code`
Запрос на проверку смс кода введенного пользователем.
```
POST http://{addr}/check_code
```

Пример команды при помощи служебной программы [cURL]:
```sh
curl -v -X POST -H "Content-Type: application/json" -d '{"phone":"380632223344", "code":"3854"}' http://{addr}/check_code
```

Запрос происходит в следующем формате:
```
{
  "phone": "string", // Телефон пользователя в международном формате
  "code":  "string"  // Код введенный пользователем
}
```

Возможны следующие коды состояния при отправке данных на сервис:
* `200` - смс код принят, пользователь допущен к бронированию
* `500` - код не принят

В случае ошибки 500, в теле ответа будет передана структура следующего формата:
```
{
  "code": "string", // Код ошибки
  "text": "string"  // Описание ошибки
}
```

### `/send_code`
Запрос на отправку смс кода для пользователя. Код имеет срок жизни в течении 5-ти минут, после чего уничтожается, и для прохождения проверки, код нужно будет высылать повторно.
```
POST http://{addr}/send_code
```

Пример команды при помощи служебной программы [cURL]:
```sh
curl -v -X POST -H "Content-Type: application/json" -d '{"phone":"380632223344"}' http://{addr}/send_code
```

Запрос происходит в следующем формате:
```
{
  "phone": "string" // Телефон пользователя в международном формате
}
```

Возможны следующие коды состояния при отправке данных на сервис:
* `200` - смс код отправлен
* `500` - нет возможности отправить смс код

В случае ошибки 500, в теле ответа будет передана структура следующего формата:
```
{
  "code": "string", // Код ошибки
  "text": "string"  // Описание ошибки
}
```

### `/get_user`
Запрос на получение данных о пользователе.
```
POST http://{addr}/get_user
```

Пример команды при помощи служебной программы [cURL]:
```sh
curl -v -X POST -H "Content-Type: application/json" -d '{"id":"3282117810"}' http://{addr}/get_user
```

Сообщение отправляется в следующем формате:
```
{
  "id": "string" // Идентификатор пользователя
}
```

В случае успеха, будет получена информация в следующем формате:
```
{
  "id":    "string", // Идентификатор пользователя
  "phone": "string", // Телефон пользователя в международном формате
  "cert":  "string"  // Статус аутентификации пользователя
}
```

Пример ответа от сервиса:
```
{
  "id":    "654886", 
  "phone": "380683335566",
  "cert":  "true"
}
```

Возможны следующие коды состояния при отправке данных на сервис:
* `200` - запрос успешно обработан
* `404` - пользователь не найден

В случае ошибки 404, в теле ответа будет передана структура следующего формата:
```
{
  "code": "string", // Код ошибки
  "text": "string"  // Описание ошибки
}
```

[Markdown]:https://ru.wikipedia.org/wiki/Markdown
[JSON]:http://json.org/json-ru.html
[UTF-8]:https://ru.wikipedia.org/w/index.php?title=UTF-8
[BOM]:https://ru.wikipedia.org/w/index.php?oldid=70741439
[HTTP]:https://ru.wikipedia.org/wiki/HTTP
[cURL]:https://ru.wikipedia.org/wiki/CURL
