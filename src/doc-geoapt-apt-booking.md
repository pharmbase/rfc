# API Бронирования данных в geoapteka.ua/ru для аптечных сетей
*Этот файл поддерживается в формате [Markdown]*

## Соглашения
1. Протокол передачи данных [HTTP], а также [NATS] в качестве системы скоростной доставки.

2. Формат приема-передачи данных [JSON] созданный в кодировке [UTF-8] без [BOM].

3. Коды состояния [стандартные](http://en.wikipedia.org/wiki/List_of_HTTP_status_codes) и возвращаются всегда. Клиент имеет право на их интерпретацию. Ошибки могут быть дополнительно подробно описаны в теле ответа запроса.

4. Обмен данными происходит посредством кодов и идентификаторов из каталога компании Морион.

5. Возможны следующие коды состояния:
  * `200` - запрос выполнен успешно.
  * `401` - неверный логин или пароль в запросе.
  * `500` - внутренняя ошибка сервиса.
  В случае получение статуса `500`, в теле ответа будет содержатся `"string"` поле с описанием ошибки.
  
## Принцип работы
АПИ предоставляет для клиентов гибкий инструментарий, дающий возможность обрабатывать заказы как централизовано, так и распределяя заказы по торговым точкам. Для этого предоставляется набор методов, которые имеют разную сложность, скорость и надежность доставки.


### Соединение
1. Тип соединения с [NATS] - [TLS]

2. Для соединения, вам понадобится IP-адрес, а также Логин и Пароль, которые вы можете узнать у вашего менеджера.

3. При подключении к сервису [NATS], торговой точке необходимо пройти процедуру регистрации.

### Обмен данными
1. После успешной регистрации, торговая точка подключается к одному из каналов для постоянного прослушивания.

2. Один из каналов торговая точка прослушивает в режиме реального времени, и использует его непосредственно для бронирования товаров.
Во второй приходят запросы для проверки остатков по товарам.

3. При получении данных из канала бронирования, торговая точка должна *присвоить* заказу один из двух статусов, в специальном поле формата, и отдать ответ по принципу Request–Response.

4. В случае отмена брони, ее продаже, или изменении номенклатуры при продаже, торговая точка *отсылает полный набор обновленных данных* используя HTTP метод.

5. Предусмотрен вариант демонстрационного бронирования, при котором торговая точка получит специальный флаг, который информирует ее о том, что клиент не намерен реально бронировать товар.
В этом случае, торговая точка просто отдает данные, помечая ее соответствующим статусом, но реальное бронирование по остаткам не выполняет.

6. При штатном завершении работы, торговая точка отключается от канала прослушивания посредством команды `connect.Close()` из пакета [NATS].


## Методы
  
  
  

[Markdown]:https://ru.wikipedia.org/wiki/Markdown
[JSON]:http://json.org/json-ru.html
[UTF-8]:https://ru.wikipedia.org/w/index.php?title=UTF-8
[BOM]:https://ru.wikipedia.org/w/index.php?oldid=70741439
[TCP]:https://ru.wikipedia.org/wiki/TCP
[TLS]:https://ru.wikipedia.org/wiki/TLS
[NATS]:http://nats.io
[HTTP]:https://ru.wikipedia.org/wiki/HTTP
