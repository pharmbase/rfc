# API работы с данными в UserDB
*Этот файл поддерживается в формате [Markdown]*

## Соглашения
1. Протокол передачи данных [HTTP]

2. Формат приема-передачи данных [JSON] созданный в кодировке [UTF-8] без [BOM].

3. Коды состояния [стандартные](http://en.wikipedia.org/wiki/List_of_HTTP_status_codes) и возвращаются всегда. Клиент имеет право на их интерпретацию. Ошибки могут быть дополнительно подробно описаны в теле ответа запроса.

## Методы

### `/check_user`
Запрос на проверку пользователя. В случае, если пользователь не проверен, на его номер телефона будет отправлен 4х-значный код для прохождения проверки.
```
POST http://{addr}/check_user
```

Пример команды при помощи служебной программы [cURL]:
```sh
curl -X POST -T "user_phone.json" http://{addr}/check_user
```

Сообщение отправляется в следующем формате:
```
{
  "phone": "string" // Телефон пользователя в международном формате
}
```

Пример первого сообщения:
```
{
  "phone": "380631234567"
}
```

Ответ будет получен в следующем формате:
```
{
  "id":   "string", // Идентификатор пользователя
  "cert": "string"  // Статус пользователя
}
```

Пример ответа от сервиса:
```
{
  "id":   "654886", 
  "cert": "false"
}
```

Где статус пользователя описывает состояние проверки данного идентификатора:
* `true` - данный идентификатор является проверенным и может выполнять бронирование.
* `false` - данный идентификатор не является проверенным и на него отправлено СМС с кодом подтверждения.

Возможны следующие коды состояния при отправке данных на сервис:
* `200` - данные успешно обработаны, отправлен ответ
* `500` - внутренняя ошибка сервера

В случае ошибки 500, в теле ответа будет передана структура следующего формата:
```
{
  "code": "string", // Код ошибки
  "text": "string"  // Описание ошибки
}
```

### `/check_code`
Запрос на проверку смс кода введенного пользователем.
```
POST http://{addr}/check_code
```

Пример команды при помощи служебной программы [cURL]:
```sh
curl -X POST -T "user_code.json" http://{addr}/check_code
```

Запрос происходит в следующем формате:
```
{
  "id":   "string", // Идентификатор пользователя
  "code": "string"  // Код введенный пользователем
}
```

Возможны следующие коды состояния при отправке данных на сервис:
* `200` - смс код принят, пользователь допущен к бронированию
* `500` - внутренняя ошибка сервера

В случае ошибки 500, в теле ответа будет передана структура следующего формата:
```
{
  "code": "string", // Код ошибки
  "text": "string"  // Описание ошибки
}
```

### `/get_user`
Запрос на получение данных о пользователе.
```
POST http://{addr}/get_user
```

Пример команды при помощи служебной программы [cURL]:
```sh
curl -X POST -T "user_info.json" http://{addr}/get_user
```

Сообщение отправляется в следующем формате:
```
{
  "id": "string" // Идентификатор пользователя
}
```

В случае успеха, будет получена информация в следующем формате:
```
{
  "id":    "string", // Идентификатор пользователя
  "phone": "string"  // Телефон пользователя в международном формате
}
```

Пример ответа от сервиса:
```
{
  "id":    "654886", 
  "phone": "380683335566"
}
```

Возможны следующие коды состояния при отправке данных на сервис:
* `200` - запрос успешно обработан
* `500` - внутренняя ошибка сервера

В случае ошибки 500, в теле ответа будет передана структура следующего формата:
```
{
  "code": "string", // Код ошибки
  "text": "string"  // Описание ошибки
}
```

[Markdown]:https://ru.wikipedia.org/wiki/Markdown
[JSON]:http://json.org/json-ru.html
[UTF-8]:https://ru.wikipedia.org/w/index.php?title=UTF-8
[BOM]:https://ru.wikipedia.org/w/index.php?oldid=70741439
[HTTP]:https://ru.wikipedia.org/wiki/HTTP
[cURL]:https://ru.wikipedia.org/wiki/CURL
